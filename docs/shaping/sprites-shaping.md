---
shaping: true
---

# Sprite Generator — Shaping

## Requirements (R)

| ID | Requirement | Status |
|----|-------------|--------|
| R0 | Generate a MapLibre-compatible sprite sheet (PNG + JSON) for a vibe | Core goal |
| R1 | Art is generated by an AI tool — not hand-coded | Must-have |
| R2 | PNG pixel coordinates match JSON manifest exactly | Must-have |
| R3 | Pipeline is repeatable — same process works for each new vibe | Must-have |
| R4 | Output renders correctly in MapLibre (icons appear on the map) | Must-have |
| R5 | Finalize and done — no ongoing maintenance after a vibe is complete | Must-have |

---

## The Core Tension

AI image tools are good at **art** but bad at **precision**.
Precision packing (exact pixel coordinates, zero gaps, exact canvas size) is what code is good at.

The shapes below are different ways to divide this responsibility.

---

## A: Single AI prompt (current approach)

Ask AI to generate the complete sprite sheet — art and layout — in one prompt.

| Part | Mechanism |
|------|-----------|
| A1 | Prompt specifies canvas size, icon layout, zero gaps, JSON format |
| A2 | AI outputs PNG + JSON in one pass |

---

## B: Per-icon AI generation + Python packer

Generate each icon individually via AI. A Python script resizes and packs them into a precise sprite sheet and generates the JSON manifest.

| Part | Mechanism |
|------|-----------|
| B1 | AI generates each icon as a standalone image (one prompt per icon or small batch) |
| B2 | Python script: resize each icon to 21×21 with nearest-neighbor interpolation |
| B3 | Python script: pack icons left-to-right into sprite sheet PNG |
| B4 | Python script: auto-generate JSON manifest from pack order |

---

## C: AI generates at 3× scale + Python downscale + pack ✅ Selected

Same as B but generate icons at 63×63px (3× target size). AI tools produce more readable pixel art at larger scale; nearest-neighbor downscale to 21×21 preserves hard edges.

| Part | Mechanism |
|------|-----------|
| C1 | AI generates each icon as an individual 63×63 PNG, named by icon name |
| C2 | `scripts/build_sprites.py <vibe>` reads `assets/sprites/<vibe>/<name>.png` |
| C3 | Script resizes each icon to 21×21 (roads to their target dims) via nearest-neighbor |
| C4 | Script packs icons per `ICON_ROWS` layout, places road shields at final row |
| C5 | Script writes `src/static/sprites/<vibe>.png` + `<vibe>.json` — manifest is auto-generated from pack order |

---

## D: AI generates reference sheet + Python extraction

Reuse what nano banana already does well (large labeled preview). Python script extracts each icon from known grid positions, resizes, and repacks.

| Part | Mechanism |
|------|-----------|
| D1 | AI generates full preview sheet (current output — 1408×768, large icons) |
| D2 | Python script: locate each icon in the preview by known grid offsets |
| D3 | Python script: crop each icon, resize to 21×21, repack + generate JSON |

---

## Fit Check

| Req | Requirement | Status | A | B | C | D |
|-----|-------------|--------|---|---|---|---|
| R0 | Generate a MapLibre-compatible sprite sheet (PNG + JSON) for a vibe | Core goal | ✅ | ✅ | ✅ | ✅ |
| R1 | Art is generated by an AI tool — not hand-coded | Must-have | ✅ | ✅ | ✅ | ✅ |
| R2 | PNG pixel coordinates match JSON manifest exactly | Must-have | ❌ | ✅ | ✅ | ❌ |
| R3 | Pipeline is repeatable — same process works for each new vibe | Must-have | ❌ | ✅ | ✅ | ❌ |
| R4 | Output renders correctly in MapLibre (icons appear on the map) | Must-have | ❌ | ✅ | ✅ | ❌ |
| R5 | Finalize and done — no ongoing maintenance after a vibe is complete | Must-have | ✅ | ✅ | ✅ | ✅ |

**Notes:**
- A fails R2/R3/R4: AI can't reliably produce pixel-exact packed sheets — proven by two failed attempts
- D fails R2/R3: icon positions in the AI preview are not reliably grid-aligned; extraction is fragile and breaks when AI changes layout
- B and C both pass — difference is art quality vs complexity
- C is preferred over B: generating at 63×63 gives AI more pixels to work with, producing better-looking art; nearest-neighbor downscale preserves pixel-art hard edges perfectly
